{{template "head.htm" .}}
    <main class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item active" aria-current="page"><i class="bi bi-house-door-fill"></i> Home</li>
        </ol>
      </nav>
      <div ref="liveAlertPlaceholder"></div>
      <div class="accordion" id="accordionOrg">
        {{range $index, $element := .Orgs}}
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-{{$index}}">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{$index}}" aria-expanded="true" aria-controls="collapse-{{$index}}">
                <i class="bi bi-building"></i> {{.Name}}
              </button>
            </h2>
            <div id="collapse-{{$index}}" class="accordion-collapse collapse show" aria-labelledby="heading-{{$index}}" data-bs-parent="#accordionOrg">
              <div class="accordion-body">
                {{range .Repos}}
                  <h5 class="d-inline-block me-2">
                    <span class="badge text-bg-{{if .Empty}}danger{{else}}secondary{{end}}" role="button" @click="openRepo" :data-org="'{{$element.Name}}'" :data-repo="'{{.Name}}'" :data-branch="'{{.DefaultBranch}}'"><i class="bi bi-{{if .Empty}}x{{else}}git{{end}}"></i> {{.Name}}</span>
                  </h5>
                {{end}}
              </div>
            </div>
          </div>
        {{end}}
      </div>
    </main>

    <script>
      'use strict'
      const { createApp } = Vue
      createApp({
        data() {
          return {
            hostname: '{{.Hostname}}',
            org: "{{.DefaultOrg.Name}}",
            repo: '',
            btnOpenRepoDisabled: true
          }
        },
        computed: {},
        methods: {
          change() {
            if (this.org && this.repo) {
              this.btnOpenRepoDisabled = false
            } else {
              this.btnOpenRepoDisabled = true
            }
          },
          newRepo() {
            if (this.org && this.repo) {
              axios.post(`/orgs/${this.org}/repos/${this.repo}/new`, {
                org: this.org,
                repo: this.repo
              }).then((res) => {
                console.log(res)
                window.location.href = '/'
              }).catch((err) => {
                console.log(err)
              }).finally(() => {
                this.org = "{{.DefaultOrg.Name}}"
                this.repo = ''
                this.btnOpenRepoDisabled = true
              })
            } else {
              this.btnOpenRepoDisabled = true
            }
          },
          openRepo(e) {
            const dataset = e.currentTarget.dataset
            const org = dataset.org
            const repo = dataset.repo
            const branch = dataset.branch
            if (branch) {
              window.location.href = `/${org}/${repo}/tree/${branch}`
            } else {
              const alertPlaceholder = this.$refs.liveAlertPlaceholder
              
              const alert = (message, type) => {
                const wrapper = document.createElement('div')
                wrapper.innerHTML = [
                  `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                  `   <div>${message}</div>`,
                  '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                  '</div>'
                ].join('')

                alertPlaceholder.append(wrapper)
              }

              alert(`git clone git@${this.hostname}:${org}/${repo}.git`, 'danger')
            }
          }
        },
        created() {},
        mounted() {
          const that = this
          that.$refs.modalNewRepo.addEventListener('hidden.bs.modal', () => {
            that.org = "{{.DefaultOrg.Name}}"
            that.repo = ''
            that.btnOpenRepoDisabled = true
          })
        },
        delimiters: ['{[{', '}]}'],
      }).mount('#app')
    </script>
{{template "foot.htm" .}}